import{j as e}from"./ui-vendor-Bw2ZGllB.js";import{u as s,r as a}from"./react-vendor-CMCxm6aa.js";import{f as t,u as l,s as r,B as i,C as n,b as c,d,e as o,I as m}from"./index-GErBfjjf.js";import{a as u,U as x}from"./UnifiedNavigation-BDbLMdcf.js";import{A as h}from"./arrow-left-DfyKVgL0.js";import{C as f}from"./calendar-CWT2bYI2.js";import{B as p}from"./loader-circle-2y9w6RF_.js";import{H as j}from"./history-C4oHWOPY.js";import"./utils-BjC949i_.js";import"./button-D4zDVS4b.js";function v(){var v;const{user:b}=t(),g=s(),{toast:N}=l(),[w,y]=a.useState(null),[S,_]=a.useState({savedArticles:0,searchHistory:0}),[k,A]=a.useState(""),[C,E]=a.useState(!0),[P,q]=a.useState(!1);a.useEffect(()=>{b?H():g("/")},[b,g]);const H=async()=>{if(b)try{const[e,s]=await Promise.allSettled([F(),B()]);"fulfilled"===e.status&&e.value&&(y(e.value),A(e.value.full_name||"")),"fulfilled"===s.status&&_(s.value)}catch(e){N({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{E(!1)}},F=async()=>{var e;if(!b)return null;const{data:s,error:a}=await r.from("profiles").select("*").eq("id",b.id).single();if(a&&"PGRST116"===a.code){const{data:s,error:a}=await r.from("profiles").insert({id:b.id,email:b.email,full_name:(null==(e=b.user_metadata)?void 0:e.full_name)||null}).select().single();if(a)throw a;return s}if(a)throw a;return s},B=async()=>{if(!b)return{savedArticles:0,searchHistory:0};const[e,s]=await Promise.all([r.from("saved_articles").select("id",{count:"exact",head:!0}).eq("user_id",b.id),r.from("search_history").select("id",{count:"exact",head:!0}).eq("user_id",b.id)]);return{savedArticles:e.count||0,searchHistory:s.count||0}};(null==w?void 0:w.full_name)||null==(v=null==w?void 0:w.email)||v.split("@")[0];const U=w?new Date(w.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900",children:[e.jsx(u,{}),e.jsxs("div",{className:"container mx-auto px-4 pt-24 pb-12 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(i,{variant:"ghost",onClick:()=>g("/"),className:"mb-4 text-white hover:text-gray-200",children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Back to NewsGlide"]}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Your Profile"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(n,{className:"glass-card border-white/10",children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2 text-white",children:[e.jsx(x,{className:"h-5 w-5"}),"Profile Information"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-1 block",children:"Email"}),e.jsx(m,{value:(null==w?void 0:w.email)||"",disabled:!0,className:"bg-white/10 border-white/10 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-1 block",children:"Full Name"}),e.jsx(m,{value:k,onChange:e=>A(e.target.value),placeholder:"Enter your full name",maxLength:50,disabled:C,className:"bg-white/10 border-white/10 text-white placeholder:text-gray-400"})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",U]})]}),e.jsx(i,{onClick:async()=>{if(b&&w){q(!0);try{const{error:e}=await r.from("profiles").update({full_name:k.trim()||null}).eq("id",b.id);e?N({title:"Error",description:"Failed to update profile",variant:"destructive"}):(y(e=>e?{...e,full_name:k.trim()||null}:null),N({title:"Success",description:"Profile updated successfully"}))}catch(e){N({title:"Error",description:"Failed to update profile",variant:"destructive"})}finally{q(!1)}}},disabled:P||C||k===((null==w?void 0:w.full_name)||""),className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white",children:P?"Saving...":"Save Changes"})]})]}),e.jsxs(n,{className:"glass-card border-white/10",children:[e.jsx(c,{children:e.jsx(d,{className:"text-white",children:"Your Activity"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-500/20 rounded-lg glass-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-blue-400"}),e.jsx("span",{className:"font-medium text-white",children:"Saved Articles"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-400",children:C?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400"}):S.savedArticles})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-500/20 rounded-lg glass-card",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5 text-purple-400"}),e.jsx("span",{className:"font-medium text-white",children:"Searches Made"})]}),e.jsx("span",{className:"text-2xl font-bold text-purple-400",children:C?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-400"}):S.searchHistory})]})]})]})]})]})]})}export{v as default};
