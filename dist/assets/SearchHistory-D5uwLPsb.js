import{u as ve,a as ye,i as fe,r as i,j as e,B as c,T as we,f as Ne,g as z,h as I,G as w,K as N,I as be,D as Se,b as Ce,d as Ae,e as Te}from"./index-BFVSuNBS.js";import{B as O}from"./badge-DZaAhHAm.js";import{b as E,T as De,F as ke,A as He,a as _e,c as Le}from"./ArticleViewer-YUjUT2OJ.js";import{g as Ee,S as F,u as Fe,l as Be,A as R,b as Y,d as G,e as P,f as U,h as Q,i as q,j as K,k as Ve}from"./alert-dialog-Bxq6_kRf.js";import{S as $,a as J,b as X,d as Z,e as b,E as ee}from"./select-UIomGo4A.js";import{g as Me,d as We,c as ze,R as Ie}from"./searchHistoryService-C_-0HUGn.js";import{L as Oe}from"./loader-circle-DnJb0dIx.js";import{A as Re}from"./arrow-left-M_JDR--f.js";import{H as se}from"./history-B6YU_vu7.js";import{B as ae}from"./bookmark-CqJ7L7bN.js";import{C as Ye}from"./calendar-DtZTO_cH.js";const as=()=>{const{user:o}=ve(),{toast:d}=ye(),x=fe(),[g,D]=i.useState([]),[h,S]=i.useState([]),[B,V]=i.useState([]),[te,M]=i.useState(!0),[r,j]=i.useState(null),[re,k]=i.useState(!1),[p,H]=i.useState(null),[W,le]=i.useState("history"),[C,ie]=i.useState(""),[v,ne]=i.useState("all"),[_,ce]=i.useState("date"),[A,oe]=i.useState("desc");i.useEffect(()=>{if(!o){x("/");return}de(),he()},[o,x]),i.useEffect(()=>{xe()},[h,C,v,_,A]);const de=async()=>{if(o){M(!0);try{const s=await Me(o.id);D(s)}catch{d({title:"Error",description:"Failed to load search history. Please try again.",variant:"destructive"})}finally{M(!1)}}},he=async()=>{if(o)try{const s=await Ee(o.id);S(s),V(s)}catch(s){console.error("Failed to load saved articles:",s)}},xe=()=>{let s=[...h];if(C.trim()){const t=C.toLowerCase();s=s.filter(a=>{var l,n;return a.headline.toLowerCase().includes(t)||a.topic.toLowerCase().includes(t)||((l=a.notes)==null?void 0:l.toLowerCase().includes(t))||((n=a.tags)==null?void 0:n.some(L=>L.toLowerCase().includes(t)))})}v&&v!=="all"&&(s=s.filter(t=>{var a;return(a=t.tags)==null?void 0:a.includes(v)})),s.sort((t,a)=>{let l,n;switch(_){case"date":l=new Date(t.saved_at),n=new Date(a.saved_at);break;case"title":l=t.headline.toLowerCase(),n=a.headline.toLowerCase();break;case"topic":l=t.topic.toLowerCase(),n=a.topic.toLowerCase();break;default:l=new Date(t.saved_at),n=new Date(a.saved_at)}return l<n?A==="asc"?-1:1:l>n?A==="asc"?1:-1:0}),V(s)},me=()=>{const s=new Set;return h.forEach(t=>{var a;(a=t.tags)==null||a.forEach(l=>s.add(l))}),Array.from(s).sort()},ue=s=>{x("/",{state:{searchTopic:s}}),d({title:"Re-running Search",description:`Searching for: ${s}`})},ge=async()=>{if(!p)return;await We(p.id)?(D(t=>t.filter(a=>a.id!==p.id)),d({title:"Search Deleted",description:"The search has been removed from your history."}),(r==null?void 0:r.id)===p.id&&j(null)):d({title:"Error",description:"Failed to delete search. Please try again.",variant:"destructive"}),H(null)},je=async s=>{await Ve(s.id)?(S(a=>a.filter(l=>l.id!==s.id)),d({title:"Article Deleted",description:"The article has been removed from your saved articles."}),(r==null?void 0:r.id)===s.id&&j(null)):d({title:"Error",description:"Failed to delete article. Please try again.",variant:"destructive"})},pe=async()=>{if(!o)return;await ze(o.id)?(D([]),d({title:"History Cleared",description:"All search history has been removed."})):d({title:"Error",description:"Failed to clear history. Please try again.",variant:"destructive"}),k(!1)},y=(s=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(a.getTime()-24*60*60*1e3),n=new Date(a.getTime()-7*24*60*60*1e3),L=new Date(a.getTime()-30*24*60*60*1e3),m={today:[],yesterday:[],thisWeek:[],thisMonth:[],older:[]};return s.forEach(u=>{const T=new Date(u.created_at);T>=a?m.today.push(u):T>=l?m.yesterday.push(u):T>=n?m.thisWeek.push(u):T>=L?m.thisMonth.push(u):m.older.push(u)}),m})(g);if(te)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading your data..."})]})});const f=(s,t)=>t.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-700 flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),s,e.jsx(O,{variant:"outline",children:t.length})]}),e.jsx("div",{className:"space-y-4",children:t.map(a=>e.jsx(w,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm hover:shadow-xl transition-all duration-300",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:a.topic}),e.jsx("p",{className:"text-sm text-blue-600 mb-2 line-clamp-1",children:a.news_data.headline}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Searched on ",new Date(a.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>ue(a.topic),children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Search Again"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>j(a),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"View Results"]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>H(a),className:"text-red-600 hover:text-red-700",children:e.jsx(E,{className:"h-4 w-4"})})]})]})})},a.id))})]},s);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(c,{onClick:()=>x("/"),variant:"ghost",className:"mb-4",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Back to NewsGlide"]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/lovable-uploads/4aa0d947-eb92-4247-965f-85f5d500d005.png",alt:"NewsGlide Logo",className:"h-8 w-8"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Search History & Saved Articles"})]}),W==="history"&&g.length>0&&e.jsxs(c,{variant:"outline",onClick:()=>k(!0),className:"text-red-600 hover:text-red-700",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Clear All History"]})]})]}),e.jsxs(we,{value:W,onValueChange:s=>le(s),children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(z,{value:"history",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Search History (",g.length,")"]}),e.jsxs(z,{value:"saved",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Saved Articles (",h.length,")"]})]}),e.jsx(I,{value:"history",children:g.length===0?e.jsx(w,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(se,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-600",children:"No Search History Yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start exploring news topics and your searches will appear here!"}),e.jsxs(c,{onClick:()=>x("/"),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Start Searching"]})]})}):e.jsxs("div",{children:[f("Today",y.today),f("Yesterday",y.yesterday),f("This Week",y.thisWeek),f("This Month",y.thisMonth),f("Older",y.older)]})}),e.jsxs(I,{value:"saved",children:[e.jsx(w,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm mb-6",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(be,{placeholder:"Search saved articles...",value:C,onChange:s=>ie(s.target.value),className:"pl-10"})]}),e.jsxs($,{value:v,onValueChange:ne,children:[e.jsxs(J,{children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),e.jsx(X,{placeholder:"Filter by tag"})]}),e.jsxs(Z,{children:[e.jsx(b,{value:"all",children:"All tags"}),me().map(s=>e.jsx(b,{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{value:_,onValueChange:s=>ce(s),children:[e.jsxs(J,{children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),e.jsx(X,{})]}),e.jsxs(Z,{children:[e.jsx(b,{value:"date",children:"Date Saved"}),e.jsx(b,{value:"title",children:"Title"}),e.jsx(b,{value:"topic",children:"Topic"})]})]}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>oe(s=>s==="asc"?"desc":"asc"),children:A==="asc"?e.jsx(He,{className:"h-4 w-4"}):e.jsx(_e,{className:"h-4 w-4"})})]})]})})}),B.length===0?e.jsx(w,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(ae,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-600",children:h.length===0?"No Saved Articles Yet":"No Articles Match Your Filters"}),e.jsx("p",{className:"text-gray-500 mb-6",children:h.length===0?"Start exploring news and save articles that interest you!":"Try adjusting your search or filter criteria."}),h.length===0&&e.jsxs(c,{onClick:()=>x("/"),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Start Exploring"]})]})}):e.jsx("div",{className:"grid gap-6",children:B.map(s=>e.jsx(w,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm hover:shadow-xl transition-all duration-300",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:s.headline}),e.jsxs("p",{className:"text-sm text-blue-600 mb-2",children:["Topic: ",s.topic]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.tags.map((t,a)=>e.jsx(O,{variant:"secondary",className:"text-xs",children:t},a))}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Saved on ",new Date(s.saved_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>j(s),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"View"]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>je(s),className:"text-red-600 hover:text-red-700",children:e.jsx(E,{className:"h-4 w-4"})})]})]})})},s.id))})]})]}),e.jsx(Se,{open:!!r,onOpenChange:()=>j(null),children:e.jsxs(Ce,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ae,{children:e.jsx(Te,{children:r&&"article_data"in r?"Saved Article":"Search Results"})}),r&&e.jsx(Le,{article:"article_data"in r?r:{id:r.id,user_id:r.user_id,headline:r.news_data.headline,topic:r.topic,article_data:r.news_data,notes:"",tags:[],saved_at:r.created_at},showEditableFields:"article_data"in r,onUpdateNotes:s=>{"article_data"in r&&(Fe(r.id,s),S(t=>t.map(a=>a.id===r.id?{...a,notes:s}:a)))},onUpdateTags:s=>{"article_data"in r&&(Be(r.id,s),S(t=>t.map(a=>a.id===r.id?{...a,tags:s}:a)))}})]})}),e.jsx(R,{open:!!p,onOpenChange:()=>H(null),children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(P,{children:"Delete Search"}),e.jsx(U,{children:"Are you sure you want to delete this search from your history? This action cannot be undone."})]}),e.jsxs(Q,{children:[e.jsx(q,{children:"Cancel"}),e.jsx(K,{onClick:ge,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(R,{open:re,onOpenChange:k,children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(P,{children:"Clear All History"}),e.jsxs(U,{children:["Are you sure you want to clear all your search history? This will permanently delete all ",g.length," searches and cannot be undone."]})]}),e.jsxs(Q,{children:[e.jsx(q,{children:"Cancel"}),e.jsx(K,{onClick:pe,className:"bg-red-600 hover:bg-red-700",children:"Clear All"})]})]})})]})})};export{as as default};
