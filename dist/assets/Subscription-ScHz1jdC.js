import{c as b,F as w,i as I,N as R,u as U,M as L,a as T,r as B,j as e,B as d,G as m,H as x,J as u,K as p,W as c}from"./index-BFVSuNBS.js";import{B as N}from"./badge-DZaAhHAm.js";import{A as F}from"./arrow-left-M_JDR--f.js";import{B as v,V as S}from"./volume-2-ses9VVJo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=b("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=b("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=b("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),V=async()=>{var n,i,t;console.log("[STRIPE SERVICE] Starting checkout session creation...");try{const{data:r,error:l}=await w.functions.invoke("create-checkout-session",{body:{}});if(console.log("[STRIPE SERVICE] Edge function response:",{hasData:!!r,hasError:!!l,data:r,error:l}),l)throw console.error("[STRIPE SERVICE] Edge function error:",l),new Error(l.message||"Failed to create checkout session");if(!(r!=null&&r.url))throw console.error("[STRIPE SERVICE] No URL in response:",r),new Error("No checkout URL returned from payment service");return console.log("[STRIPE SERVICE] Checkout session created successfully"),r}catch(r){throw console.error("[STRIPE SERVICE] Checkout session creation failed:",r),(n=r.message)!=null&&n.includes("Invalid price ID")?new Error("Payment configuration error: Price ID not found in Stripe"):(i=r.message)!=null&&i.includes("STRIPE_SECRET_KEY")?new Error("Payment configuration error: Stripe API key not configured"):(t=r.message)!=null&&t.includes("Authentication error")?new Error("Authentication error: Please sign in again"):r}},D=async()=>{const{data:n,error:i}=await w.functions.invoke("create-portal-session",{body:{}});if(i)throw new Error(i.message||"Failed to create portal session");return n},H=()=>{const n=I(),i=R(),{user:t}=U(),{isProUser:r,subscriptionTier:l,dailySearchCount:g,searchLimit:f,refreshSubscription:j}=L(),{toast:a}=T();B.useEffect(()=>{const s=i.pathname,h=new URLSearchParams(i.search).get("session_id");s==="/subscription/success"&&h?(a({title:"Payment Successful! ðŸŽ‰",description:"Welcome to NewsGlide Pro! Your subscription is now active.",duration:5e3}),j(),n("/subscription",{replace:!0})):s==="/subscription/cancel"&&(a({title:"Payment Cancelled",description:"No worries! You can upgrade anytime.",variant:"destructive"}),n("/subscription",{replace:!0}))},[i,n,j,a]);const k=async()=>{if(!t){a({title:"Sign in required",description:"Please sign in to upgrade to Pro",variant:"destructive"});return}console.log("[SUBSCRIPTION] Starting upgrade process for user:",t.id);try{a({title:"Setting up your subscription...",description:"Please wait while we redirect you to checkout"}),console.log("[SUBSCRIPTION] Creating checkout session...");const{url:s}=await V();if(console.log("[SUBSCRIPTION] Checkout URL received:",{url:s,urlLength:s==null?void 0:s.length,urlStart:s==null?void 0:s.substring(0,50),isValidUrl:s==null?void 0:s.startsWith("https://checkout.stripe.com/")}),!s||!s.startsWith("https://"))throw new Error(`Invalid checkout URL received: ${s}`);console.log("[SUBSCRIPTION] Redirecting to Stripe checkout..."),window.location.href=s}catch(s){console.error("[SUBSCRIPTION] Checkout error:",s);const o=s instanceof Error?s.message:"Failed to start checkout process",h=window.location.hostname==="localhost";a({title:"Checkout Error",description:h?`${o} (Check console for details)`:o,variant:"destructive",duration:1e4}),h&&console.error("[SUBSCRIPTION] Full error details:",{error:s,message:o,stack:s==null?void 0:s.stack,user:t==null?void 0:t.id})}},y=async()=>{if(t)try{a({title:"Opening customer portal...",description:"Redirecting to manage your subscription"});const{url:s}=await D();window.location.href=s}catch(s){console.error("Portal error:",s),a({title:"Portal Error",description:s instanceof Error?s.message:"Failed to open customer portal",variant:"destructive"})}},C=async()=>{if(t)try{a({title:"Checking payment status...",description:"Looking for your recent payment"});const{data:s,error:o}=await w.functions.invoke("fix-subscription",{body:{email:t.email}});if(o)throw o;s.upgraded?(a({title:"Success! ðŸŽ‰",description:"Your Pro subscription is now active"}),await j()):a({title:"No recent payment found",description:"Please contact support if you've made a payment",variant:"destructive"})}catch(s){console.error("Check payment error:",s),a({title:"Error checking payment",description:"Please try again or contact support",variant:"destructive"})}},E=[{name:"Daily Searches",free:"5 per day",pro:"Unlimited",icon:M},{name:"Reading Levels",free:"Base + ELI5",pro:"Base + ELI5 + PhD",icon:v},{name:"Morgan Freeman Voice",free:"Not included",pro:"Included",icon:S},{name:"Article Saving",free:"Unlimited",pro:"Unlimited",icon:c},{name:"Search History",free:"Unlimited",pro:"Unlimited",icon:c}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsxs("div",{className:"container mx-auto px-6 py-12",children:[e.jsxs(d,{onClick:()=>n("/"),variant:"ghost",className:"mb-4",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Back to NewsGlide"]}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"Your Subscription"}),e.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Choose the plan that works best for your news consumption needs."})]}),t&&e.jsxs(m,{className:"max-w-2xl mx-auto mb-8 border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Current Plan"}),r?e.jsxs(N,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Pro Plan"]}):e.jsx(N,{variant:"outline",children:"Free Plan"})]})}),e.jsx(p,{children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-green-600 font-medium",children:"âœ… You have unlimited access to all Pro features!"}),e.jsx(d,{onClick:y,variant:"outline",className:"w-full",children:"Manage Subscription"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Searches Used Today:"}),e.jsxs("span",{className:"font-bold",children:[g,"/",f]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all",style:{width:`${g/f*100}%`}})}),g>=f&&e.jsx("p",{className:"text-red-600 text-sm",children:"You've reached your daily limit. Upgrade to Pro for unlimited searches!"}),e.jsx(d,{onClick:C,variant:"outline",className:"w-full mt-2",children:"I already paid - activate my Pro subscription"})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto mb-12",children:[e.jsxs(m,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[e.jsx(x,{children:e.jsxs(u,{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",children:"Free"}),e.jsx("div",{className:"text-3xl font-bold text-gray-600",children:"$0"}),e.jsx("div",{className:"text-sm text-gray-500",children:"forever"})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"5 searches per day"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Base + ELI5 reading levels"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Article saving & history"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Interactive Q&A"})]})]}),e.jsx(d,{variant:"outline",className:"w-full",disabled:!r,children:r?"Downgrade":"Current Plan"})]})]}),e.jsxs(m,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-50 to-purple-50 relative",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(N,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-4 py-1",children:"Most Popular"})}),e.jsx(x,{children:e.jsxs(u,{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold mb-2 flex items-center justify-center gap-2",children:[e.jsx(P,{className:"h-6 w-6 text-yellow-500"}),"Pro"]}),e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"$3"}),e.jsx("div",{className:"text-sm text-gray-500",children:"per month"})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:"Unlimited searches"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{children:"PhD-level analysis"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Morgan Freeman narration"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"All Free features included"})]})]}),e.jsx(d,{onClick:r?y:k,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:r?"Manage Subscription":"Upgrade to Pro"})]})]})]}),e.jsxs(m,{className:"max-w-4xl mx-auto border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[e.jsx(x,{children:e.jsx(u,{children:"Feature Comparison"})}),e.jsx(p,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Feature"}),e.jsx("th",{className:"text-center py-3 px-4",children:"Free"}),e.jsx("th",{className:"text-center py-3 px-4",children:"Pro"})]})}),e.jsx("tbody",{children:E.map((s,o)=>e.jsxs("tr",{className:"border-b",children:[e.jsxs("td",{className:"py-3 px-4 flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.name]}),e.jsx("td",{className:"text-center py-3 px-4",children:s.free}),e.jsx("td",{className:"text-center py-3 px-4 font-medium text-blue-600",children:s.pro})]},o))})]})})})]}),!t&&e.jsxs("div",{className:"text-center mt-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Sign in to manage your subscription"}),e.jsx(d,{onClick:()=>n("/"),children:"Go to Sign In"})]})]})})};export{H as default};
