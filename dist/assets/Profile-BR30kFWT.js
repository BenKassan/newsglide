import{u as F,i as R,a as B,r as l,F as i,j as e,B as g,G as j,H as N,J as y,K as w,I as S}from"./index-BFVSuNBS.js";import{A as U}from"./arrow-left-M_JDR--f.js";import{U as q}from"./user-3a9kj-DJ.js";import{C as L}from"./calendar-DtZTO_cH.js";import{B as G}from"./bookmark-CqJ7L7bN.js";import{H as I}from"./history-B6YU_vu7.js";function z(){var b;const{user:a}=F(),d=R(),{toast:o}=B(),[r,m]=l.useState(null),[f,E]=l.useState({savedArticles:0,searchHistory:0}),[n,h]=l.useState(""),[c,_]=l.useState(!0),[x,p]=l.useState(!1);l.useEffect(()=>{if(!a){d("/");return}C()},[a,d]);const C=async()=>{if(a)try{const[s,t]=await Promise.allSettled([P(),A()]);s.status==="fulfilled"&&s.value&&(m(s.value),h(s.value.full_name||"")),t.status==="fulfilled"&&E(t.value)}catch(s){console.error("Error in fetchProfileData:",s),o({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{_(!1)}},P=async()=>{var v;if(!a)return null;let{data:s,error:t}=await i.from("profiles").select("*").eq("id",a.id).single();if(t&&t.code==="PGRST116"){const{data:D,error:u}=await i.from("profiles").insert({id:a.id,email:a.email,full_name:((v=a.user_metadata)==null?void 0:v.full_name)||null}).select().single();if(u)throw console.error("Error creating profile:",u),u;return D}else if(t)throw console.error("Error fetching profile:",t),t;return s},A=async()=>{if(!a)return{savedArticles:0,searchHistory:0};const[s,t]=await Promise.all([i.from("saved_articles").select("id",{count:"exact",head:!0}).eq("user_id",a.id),i.from("search_history").select("id",{count:"exact",head:!0}).eq("user_id",a.id)]);return{savedArticles:s.count||0,searchHistory:t.count||0}},k=async()=>{if(!(!a||!r)){p(!0);try{const{error:s}=await i.from("profiles").update({full_name:n.trim()||null}).eq("id",a.id);s?(console.error("Error updating profile:",s),o({title:"Error",description:"Failed to update profile",variant:"destructive"})):(m(t=>t?{...t,full_name:n.trim()||null}:null),o({title:"Success",description:"Profile updated successfully"}))}catch(s){console.error("Error in handleSave:",s),o({title:"Error",description:"Failed to update profile",variant:"destructive"})}finally{p(!1)}}};r!=null&&r.full_name||(b=r==null?void 0:r.email)!=null&&b.split("@")[0];const H=r?new Date(r.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"";return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(g,{variant:"ghost",onClick:()=>d("/"),className:"mb-4 hover:bg-white/10",children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Back to NewsGlide"]}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Your Profile"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(j,{className:"bg-white/80 backdrop-blur-sm border-white/20",children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Profile Information"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Email"}),e.jsx(S,{value:(r==null?void 0:r.email)||"",disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Full Name"}),e.jsx(S,{value:n,onChange:s=>h(s.target.value),placeholder:"Enter your full name",maxLength:50,disabled:c})]}),r&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:["Joined ",H]})]}),e.jsx(g,{onClick:k,disabled:x||c||n===((r==null?void 0:r.full_name)||""),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:x?"Saving...":"Save Changes"})]})]}),e.jsxs(j,{className:"bg-white/80 backdrop-blur-sm border-white/20",children:[e.jsx(N,{children:e.jsx(y,{children:"Your Activity"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Saved Articles"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:c?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}):f.savedArticles})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Searches Made"})]}),e.jsx("span",{className:"text-2xl font-bold text-purple-600",children:c?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"}):f.searchHistory})]})]})]})]})]})})}export{z as default};
