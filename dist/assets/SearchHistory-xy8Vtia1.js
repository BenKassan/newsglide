import{j as e}from"./ui-vendor-Bw2ZGllB.js";import{u as s,r as a}from"./react-vendor-CMCxm6aa.js";import{f as t,u as l,B as r,T as i,i as c,j as n,k as d,C as o,e as h,I as m,D as x,o as j,p as u,q as p}from"./index-GErBfjjf.js";import{B as g}from"./badge-3VR0oUcD.js";import{g as v,d as w,e as N,F as b,A as y,f,h as S,u as C,i as k,j as A,k as _,l as D,m as T,n as L,o as E,p as F,q as H,r as z}from"./SavedArticles-DLNyK9oJ.js";import{S as M,b as V,c as Y,d as B,e as O}from"./select-BiKeV8qV.js";import{g as P,d as R,c as W}from"./searchHistoryService-6jbQIRng.js";import{L as q,B as G,E as U}from"./loader-circle-2y9w6RF_.js";import{A as I}from"./arrow-left-DfyKVgL0.js";import{H as $}from"./history-C4oHWOPY.js";import{S as J}from"./search-iVXSCB_L.js";import{C as K}from"./calendar-CWT2bYI2.js";import{R as Q}from"./refresh-cw-B9HwsApH.js";import"./utils-BjC949i_.js";const X=()=>{const{user:X}=t(),{toast:Z}=l(),ee=s(),[se,ae]=a.useState([]),[te,le]=a.useState([]),[re,ie]=a.useState([]),[ce,ne]=a.useState(!0),[de,oe]=a.useState(null),[he,me]=a.useState(!1),[xe,je]=a.useState(null),[ue,pe]=a.useState("history"),[ge,ve]=a.useState(""),[we,Ne]=a.useState("all"),[be,ye]=a.useState("date"),[fe,Se]=a.useState("desc");a.useEffect(()=>{X?(Ce(),ke()):ee("/")},[X,ee]),a.useEffect(()=>{Ae()},[te,ge,we,be,fe]);const Ce=async()=>{if(X){ne(!0);try{const e=await P(X.id);ae(e)}catch(e){Z({title:"Error",description:"Failed to load search history. Please try again.",variant:"destructive"})}finally{ne(!1)}}},ke=async()=>{if(X)try{const e=await v(X.id);le(e),ie(e)}catch(e){}},Ae=()=>{let e=[...te];if(ge.trim()){const s=ge.toLowerCase();e=e.filter(e=>{var a,t;return e.headline.toLowerCase().includes(s)||e.topic.toLowerCase().includes(s)||(null==(a=e.notes)?void 0:a.toLowerCase().includes(s))||(null==(t=e.tags)?void 0:t.some(e=>e.toLowerCase().includes(s)))})}we&&"all"!==we&&(e=e.filter(e=>{var s;return null==(s=e.tags)?void 0:s.includes(we)})),e.sort((e,s)=>{let a,t;switch(be){case"date":default:a=new Date(e.saved_at),t=new Date(s.saved_at);break;case"title":a=e.headline.toLowerCase(),t=s.headline.toLowerCase();break;case"topic":a=e.topic.toLowerCase(),t=s.topic.toLowerCase()}return a<t?"asc"===fe?-1:1:a>t?"asc"===fe?1:-1:0}),ie(e)},_e=(e=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),t=new Date(a.getTime()-864e5),l=new Date(a.getTime()-6048e5),r=new Date(a.getTime()-2592e6),i={today:[],yesterday:[],thisWeek:[],thisMonth:[],older:[]};return e.forEach(e=>{const s=new Date(e.created_at);s>=a?i.today.push(e):s>=t?i.yesterday.push(e):s>=l?i.thisWeek.push(e):s>=r?i.thisMonth.push(e):i.older.push(e)}),i})(se);if(ce)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading your data..."})]})});const De=(s,a)=>0===a.length?null:e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-700 flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),s,e.jsx(g,{variant:"outline",children:a.length})]}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx(o,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm hover:shadow-xl transition-all duration-300",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:s.topic}),e.jsx("p",{className:"text-sm text-blue-600 mb-2 line-clamp-1",children:s.news_data.headline}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Searched on ",new Date(s.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{return e=s.topic,ee("/",{state:{searchTopic:e}}),void Z({title:"Re-running Search",description:`Searching for: ${e}`});var e},children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Search Again"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>oe(s),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"View Results"]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>je(s),className:"text-red-600 hover:text-red-700",children:e.jsx(w,{className:"h-4 w-4"})})]})]})})},s.id))})]},s);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(r,{onClick:()=>ee("/"),variant:"ghost",className:"mb-4",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Back to NewsGlide"]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/lovable-uploads/4aa0d947-eb92-4247-965f-85f5d500d005.png",alt:"NewsGlide Logo",className:"h-8 w-8"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Search History & Saved Articles"})]}),"history"===ue&&se.length>0&&e.jsxs(r,{variant:"outline",onClick:()=>me(!0),className:"text-red-600 hover:text-red-700",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Clear All History"]})]})]}),e.jsxs(i,{value:ue,onValueChange:e=>pe(e),children:[e.jsxs(c,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(n,{value:"history",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Search History (",se.length,")"]}),e.jsxs(n,{value:"saved",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Saved Articles (",te.length,")"]})]}),e.jsx(d,{value:"history",children:0===se.length?e.jsx(o,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:e.jsxs(h,{className:"p-12 text-center",children:[e.jsx($,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-600",children:"No Search History Yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start exploring news topics and your searches will appear here!"}),e.jsxs(r,{onClick:()=>ee("/"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Start Searching"]})]})}):e.jsxs("div",{children:[De("Today",_e.today),De("Yesterday",_e.yesterday),De("This Week",_e.thisWeek),De("This Month",_e.thisMonth),De("Older",_e.older)]})}),e.jsxs(d,{value:"saved",children:[e.jsx(o,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm mb-6",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(m,{placeholder:"Search saved articles...",value:ge,onChange:e=>ve(e.target.value),className:"pl-10"})]}),e.jsxs(M,{value:we,onValueChange:Ne,children:[e.jsxs(V,{children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),e.jsx(Y,{placeholder:"Filter by tag"})]}),e.jsxs(B,{children:[e.jsx(O,{value:"all",children:"All tags"}),(()=>{const e=new Set;return te.forEach(s=>{var a;null==(a=s.tags)||a.forEach(s=>e.add(s))}),Array.from(e).sort()})().map(s=>e.jsx(O,{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{value:be,onValueChange:e=>ye(e),children:[e.jsxs(V,{children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),e.jsx(Y,{})]}),e.jsxs(B,{children:[e.jsx(O,{value:"date",children:"Date Saved"}),e.jsx(O,{value:"title",children:"Title"}),e.jsx(O,{value:"topic",children:"Topic"})]})]}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>Se(e=>"asc"===e?"desc":"asc"),children:"asc"===fe?e.jsx(y,{className:"h-4 w-4"}):e.jsx(f,{className:"h-4 w-4"})})]})]})})}),0===re.length?e.jsx(o,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(G,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-600",children:0===te.length?"No Saved Articles Yet":"No Articles Match Your Filters"}),e.jsx("p",{className:"text-gray-500 mb-6",children:0===te.length?"Start exploring news and save articles that interest you!":"Try adjusting your search or filter criteria."}),0===te.length&&e.jsxs(r,{onClick:()=>ee("/"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Start Exploring"]})]})}):e.jsx("div",{className:"grid gap-6",children:re.map(s=>e.jsx(o,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm hover:shadow-xl transition-all duration-300",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-lg mb-1",children:s.headline}),e.jsxs("p",{className:"text-sm text-blue-600 mb-2",children:["Topic: ",s.topic]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:s.tags.map((s,a)=>e.jsx(g,{variant:"secondary",className:"text-xs",children:s},a))}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Saved on ",new Date(s.saved_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>oe(s),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"View"]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>(async e=>{await z(e.id)?(le(s=>s.filter(s=>s.id!==e.id)),Z({title:"Article Deleted",description:"The article has been removed from your saved articles."}),(null==de?void 0:de.id)===e.id&&oe(null)):Z({title:"Error",description:"Failed to delete article. Please try again.",variant:"destructive"})})(s),className:"text-red-600 hover:text-red-700",children:e.jsx(w,{className:"h-4 w-4"})})]})]})})},s.id))})]})]}),e.jsx(x,{open:!!de,onOpenChange:()=>oe(null),children:e.jsxs(j,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(u,{children:e.jsx(p,{children:de&&"article_data"in de?"Saved Article":"Search Results"})}),de&&e.jsx(S,{article:"article_data"in de?de:{id:de.id,user_id:de.user_id,headline:de.news_data.headline,topic:de.topic,article_data:de.news_data,notes:"",tags:[],saved_at:de.created_at},showEditableFields:"article_data"in de,onUpdateNotes:e=>{"article_data"in de&&(k(de.id,e),le(s=>s.map(s=>s.id===de.id?{...s,notes:e}:s)))},onUpdateTags:e=>{"article_data"in de&&(C(de.id,e),le(s=>s.map(s=>s.id===de.id?{...s,tags:e}:s)))}})]})}),e.jsx(A,{open:!!xe,onOpenChange:()=>je(null),children:e.jsxs(_,{children:[e.jsxs(D,{children:[e.jsx(T,{children:"Delete Search"}),e.jsx(L,{children:"Are you sure you want to delete this search from your history? This action cannot be undone."})]}),e.jsxs(E,{children:[e.jsx(F,{children:"Cancel"}),e.jsx(H,{onClick:async()=>{if(!xe)return;await R(xe.id)?(ae(e=>e.filter(e=>e.id!==xe.id)),Z({title:"Search Deleted",description:"The search has been removed from your history."}),(null==de?void 0:de.id)===xe.id&&oe(null)):Z({title:"Error",description:"Failed to delete search. Please try again.",variant:"destructive"}),je(null)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(A,{open:he,onOpenChange:me,children:e.jsxs(_,{children:[e.jsxs(D,{children:[e.jsx(T,{children:"Clear All History"}),e.jsxs(L,{children:["Are you sure you want to clear all your search history? This will permanently delete all ",se.length," searches and cannot be undone."]})]}),e.jsxs(E,{children:[e.jsx(F,{children:"Cancel"}),e.jsx(H,{onClick:async()=>{if(!X)return;await W(X.id)?(ae([]),Z({title:"History Cleared",description:"All search history has been removed."})):Z({title:"Error",description:"Failed to clear history. Please try again.",variant:"destructive"}),me(!1)},className:"bg-red-600 hover:bg-red-700",children:"Clear All"})]})]})})]})})};export{X as default};
